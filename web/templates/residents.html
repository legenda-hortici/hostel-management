{{ define "admin_residents" }}
<div class="container mt-4">
    <div class="row">
        <!-- –¢–∞–±–ª–∏—Ü–∞ –∂–∏–ª—å—Ü–æ–≤ -->
        <div class="col-md-9">
            <h2>–ñ–∏–ª—å—Ü—ã</h2>
            <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
            <div class="mb-3">
                <input type="text" class="form-control" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –∫–æ–º–Ω–∞—Ç–µ...">
            </div>
            
            <table class="table mt-4" id="residentsTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–ò–º—è</th>
                        <th>Email</th>
                        <th>–ö–æ–º–Ω–∞—Ç–∞</th>
                        <th>–ò–Ω—Å—Ç–∏—Ç—É—Ç</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range .Residents }}
                    <tr class="resident-row">
                        <td>{{ .Number }}</td>
                        <td class="resident-name">{{ .Username }}</td>
                        <td>{{ .Email }}</td>
                        <td class="room-number">{{ .RoomNumber }}</td>
                        <td class="institute-row">{{ if .Institute.Valid }}{{ .Institute.String }}{{ else }}–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö{{ end }}</td>
                        <td>
                            <a href="/admin/residents/resident/{{ .ID }}" class="btn btn-success btn-sm">
                                <i class="bi bi-info-circle"></i> <!-- –ò–∫–æ–Ω–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
                            </a>
                        </td>    
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
        
        <!-- –ë–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="col-md-3" style="margin-top: 45px;">
            <div class="card p-3 mb-4" style="flex: 1;">
                <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
                <form action="/residents" method="get" class="row g-3">
                    <div class="col-12">
                        <label for="filterInstitute" class="form-label">–ò–Ω—Å—Ç–∏—Ç—É—Ç</label>
                        <select name="institute" class="form-select" id="filterInstitute" onchange="applyFilters()">
                            <option value="" selected>–í—Å–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç—ã</option>
                            <option value="–ò–ò–ö">–ò–ò–ö</option>
                            <option value="–ò–î–≠–£">–ò–î–≠–£</option>
                            <option value="–ò–ê–¢">–ò–ê–¢</option>
                            <option value="–ò–ê–†–ö–¢">–ò–ê–†–ö–¢</option>
                            <option value="–°–ì–£">–°–ì–£</option>
                            <option value="–ò–≠–£">–ò–≠–£</option>
                            <option value="–Æ–ò">–Æ–ò</option>
                            <option value="–°–ê–¢">–°–ê–¢</option>
                        </select>
                    </div>
                </form>
                <label class="form-label mt-3">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∂–∏–ª—å—Ü–∞</label>
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
                <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#addResidentModal">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∂–∏–ª—å—Ü–∞ -->
<div class="modal fade" id="addResidentModal" tabindex="-1" aria-labelledby="addResidentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addResidentModalLabel">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∂–∏–ª—å—Ü–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/admin/residents/add_resident" method="post">
                    <div class="mb-3">
                        <label for="username" class="form-label">–ò–º—è</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="password" name="password" required readonly>
                            <button type="button" class="btn btn-secondary" onclick="generatePassword()">üîÑ</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="institute" class="form-label">–ò–Ω—Å—Ç–∏—Ç—É—Ç</label>
                        <select class="form-control" id="institute" name="institute" required>
                            <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç</option>
                            <option value="–ò–ò–ö">–ò–ò–ö</option>
                            <option value="–ò–î–≠–£">–ò–î–≠–£</option>
                            <option value="–ò–ê–¢">–ò–ê–¢</option>
                            <option value="–ò–ê–†–ö–¢">–ò–ê–†–ö–¢</option>
                            <option value="–°–ì–£">–°–ì–£</option>
                            <option value="–ò–≠–£">–ò–≠–£</option>
                            <option value="–Æ–ò">–Æ–ò</option>
                            <option value="–°–ê–¢">–°–ê–¢</option>
                        </select>
                    </div>                    
                    <div class="mb-3">
                        <label for="room" class="form-label">–ö–æ–º–Ω–∞—Ç–∞</label>
                        <input type="number" class="form-control" id="room" name="room">
                    </div>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>           
        </div>
    </div>
</div>

<script>
    function applyFilters() {
        let instituteFilter = document.getElementById("filterInstitute").value.toLowerCase();
        let rows = document.querySelectorAll(".resident-row");

        rows.forEach(row => {
            let institute = row.querySelector(".institute-row").textContent.toLowerCase();

            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∏–Ω—Å—Ç–∏—Ç—É—Ç—É
            if (instituteFilter === "" || institute.includes(instituteFilter)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è
    function generatePassword() {
        const length = 10;
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
        let password = "";
        for (let i = 0; i < length; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        document.getElementById("password").value = password;
    }

    // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏ –∫–æ–º–Ω–∞—Ç–µ
    document.getElementById("searchInput").addEventListener("input", function() {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll("#residentsTable tbody tr");

        rows.forEach(row => {
            let name = row.querySelector(".resident-name").textContent.toLowerCase();
            let room = row.querySelector(".room-number").textContent.toLowerCase();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É, –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –∏–º–µ–Ω–∏ –∏–ª–∏ –Ω–æ–º–µ—Ä–µ –∫–æ–º–Ω–∞—Ç—ã
            if (name.includes(filter) || room.includes(filter)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
</script>

{{ end }}
